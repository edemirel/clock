<!DOCTYPE html>
<html>
<head>

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

<script>

function repeatEvery(func, interval) {
	// This function courtesy of:
	// http://stackoverflow.com/questions/10795164/accurately-run-a-function-when-the-minute-changes
	
    // Check current time and calculate the delay until next interval
    var now = new Date,
    	delay = interval - now % interval;

    function start() {
        // Execute function now...
        func();
        // ... and every interval
        setInterval(func, interval);
    }

    // Delay execution until it's an even interval
    setTimeout(start, delay);
}

function startTime() {
	var today = new Date();
	var h = today.getHours();
	var m = today.getMinutes();
	if (m === 0) {
		ctt0(h, m);
	} else if (m > 0 && m < 15) {
		ctt1(h, m);
	} else if (m === 15) {
		ctt2(h, m);
	} else if (m > 15 && m < 30) {
		ctt3(h, m);
	} else if (m === 30) {
		ctt4(h, m);
	} else if (m > 30 && m < 45) {
		ctt3(h, m);
	} else if (m === 45) {
		ctt6(h, m);
	} else if (m > 45 && m <= 49) {
		ctt3(h, m);
	} else if (m >= 50 && m <= 59) {
		ctt8(h, m);
	}

	repeatEvery(startTime, 60*1000);
}

function fetchText(word, block) {
	$.getJSON("js/"+word+".json", function(json) {
		var rand = Math.floor(Math.random() * json.length);
		document.getElementById(block).innerHTML = json[rand];
	});
}

function theTimeIs() {
	var itisX = Math.random();
	if (itisX >= 0.5) {
		fetchText("the time is", "itis");
	} else {
		fetchText("it is", "itis");
	}
}

function ctt0(hour, minute) {
	theTimeIs();

	if (hour === 0) {
		fetchText("midnight", "blk1");	
	}
	else if (hour === 12) {
		fetchText("noon", "blk1");
	}
	else {
		var hr = hour;
		if (hour > 12) {
			hr = hour - 12;
		}
		fetchText(hr, "blk1");
	}

	if (hour != 0 && hour != 12) {
		fetchText("o\'clock", "blk2");

		if (hour < 12) {
			fetchText("in the morning", "blk3");
		} 
		else if (hour > 16) {
			fetchText("in the evening", "blk3");
		}
		else {
			fetchText("in the afternoon", "blk3");
		}
	}
}

function ctt1(hour, minute) {
	theTimeIs();

	fetchText(minute, "blk1");

	var m = "minutes";
	if (minute === 1) {
		m = "minute";
	}
	fetchText(m, "blk2");

	var ap = "after";
	if (Math.random() >= 0.5) {
		ap = "past";
	}
	fetchText(ap, "blk3");

	if (hour === 0) {
		fetchText("midnight", "blk4");	
	}
	else if (hour === 12) {
		fetchText("noon", "blk4");
	}
	else {
		var hr = hour;
		if (hour > 12) {
			hr = hour - 12;
		}
		fetchText(hr, "blk4");
	}

	if (hour != 0 && hour != 12) {
		fetchText("o\'clock", "blk5");

		if (hour < 12) {
			fetchText("in the morning", "blk6");
		} 
		else if (hour > 16) {
			fetchText("in the evening", "blk6");
		}
		else {
			fetchText("in the afternoon", "blk6");
		}
	}
}

function ctt2(hour, minute) {
	theTimeIs();

	fetchText("quarter", "bk1");

	var ap = "after";
	if (Math.random() >= 0.5) {
		ap = "past";
	}
	fetchText(ap, "blk2");

	if (hour === 0) {
		fetchText("midnight", "blk3");	
	}
	else if (hour === 12) {
		fetchText("noon", "blk3");
	}
	else {
		var hr = hour;
		if (hour > 12) {
			hr = hour - 12;
		}
		fetchText(hr, "blk3");
	}

	if (hour != 0 && hour != 12) {
		fetchText("o\'clock", "blk4");

		if (hour < 12) {
			fetchText("in the morning", "blk5");
		} 
		else if (hour > 16) {
			fetchText("in the evening", "blk5");
		}
		else {
			fetchText("in the afternoon", "blk5");
		}
	}
}

function ctt3(hour, minute) {
	theTimeIs();

	var hr = hour;
	if (hour === 0) {
		hr = 12;
	} else if (hour > 12) {
		hr = hour - 12;
	}
	fetchText(hr, "blk1");

	fetchText(minute, "blk2");

	if (hour != 0 && hour != 12) {
		if (hour < 12) {
			fetchText("in the morning", "blk3");
		} 
		else if (hour > 16) {
			fetchText("in the evening", "blk3");
		}
		else {
			fetchText("in the afternoon", "blk3");
		}
	}
	else {
		if (hour === 0) {
			fetchText("ante meridiem", "blk3");
		} 
		else if (hour === 12) {
			fetchText("post meridiem", "blk3");
		}
	}
}

function ctt4(hour, minute) {
	theTimeIs();

	fetchText("half", "blk1");

	fetchText("past", "blk2");

	if (hour === 0) {
		fetchText("midnight", "blk3");	
	}
	else if (hour === 12) {
		fetchText("noon", "blk3");
	}
	else {
		var hr = hour;
		if (hour > 12) {
			hr = hour - 12;
		}
		fetchText(hr, "blk3");
	}

	if (hour != 0 && hour != 12) {
		fetchText("o\'clock", "blk4");

		if (hour < 12) {
			fetchText("in the morning", "blk5");
		} 
		else if (hour > 16) {
			fetchText("in the evening", "blk5");
		}
		else {
			fetchText("in the afternoon", "blk5");
		}
	}
}

function ctt6(hour, minute) {
	theTimeIs();

	fetchText("quarter", "blk1");

	var tu = "to";
	if (Math.random() >= 0.5) {
		tu = "until";
	}
	fetchText(tu, "blk2");

	if (hour === 11) {
		fetchText("noon", "blk3");
	}
	else if (hour === 23) {
		fetchText("midnight", "blk3");
	}
	else {
		fetchText(hour+1, "blk3");

		fetchText("o\'clock", "blk4");

		if (hour <= 10) {
			fetchText("in the morning", "blk5");
		} else if (hour >= 16) {
			fetchText("in the evening", "blk5");
		} else {
			fetchText("in the afternoon", "blk5");
		}
	}
}

function ctt8(hour, minute) {
	theTimeIs();

	fetchText(60-minute, "blk1");

	var m = "minutes";
	if (minute === 59) {
		m = "minute";
	}
	fetchText(m, "blk2");

	var tu = "to";
	if (Math.random() >= 0.5) {
		tu = "until";
	}
	fetchText(tu, "blk3");

	if (hour === 11) {
		fetchText("noon", "blk4");
	}
	else if (hour === 23) {
		fetchText("midnight", "blk4");
	}
	else {
		fetchText(hour+1, "blk4");

		fetchText("o\'clock", "blk5");

		if (hour <= 10) {
			fetchText("in the morning", "blk6");
		} else if (hour >= 16) {
			fetchText("in the evening", "blk6");
		} else {
			fetchText("in the afternoon", "blk6");
		}
	}
}

</script>

<style>

.clocktext {
	color: red;
}

</style>

</head>
<body onload="startTime()">

<div id="itis"></div>
<div id="blk1"></div>
<div id="blk2"></div>
<div id="blk3"></div>
<div id="blk4"></div>
<div id="blk5"></div>
<div id="blk6"></div>


</body>
</html>